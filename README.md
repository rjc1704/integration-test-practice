# Express + Prisma + Supertest ν†µν•©ν…μ¤νΈ μμ 

μ΄ ν”„λ΅μ νΈλ” Express.js, Prisma ORM, κ·Έλ¦¬κ³  Supertestλ¥Ό μ‚¬μ©ν• ν†µν•©ν…μ¤νΈ μμ μ…λ‹λ‹¤.
docker λ¥Ό μ‚¬μ©ν•μ—¬ postgres:13 μ…‹μ—…ν•μ—¬ μ‹¤μµ μ§„ν–‰ν•©λ‹λ‹¤. (νΈμμƒ maimdb, testdb λ‘λ‹¤ dockerλ΅ μ…‹μ—…).

## π€ κΈ°λ¥

- **Express.js**: μ›Ή μ„λ²„ ν”„λ μ„μ›ν¬
- **Prisma**: PostgreSQL ORM
- **Supertest**: HTTP ν†µν•©ν…μ¤νΈ
- **λ―Έλ“¤μ›¨μ–΄ 3κ°**: Helmet (λ³΄μ•), Morgan (λ΅κΉ…), express.json (JSON νμ‹±)
- **TypeScript**: νƒ€μ… μ•μ „μ„±

## π“ ν”„λ΅μ νΈ κµ¬μ΅°

```
cicd-practice/
β”β”€β”€ src/
β”‚   β”β”€β”€ app.ts              # Express μ•± μ„¤μ • (λ―Έλ“¤μ›¨μ–΄ + λΌμ°ν„°)
β”‚   β”β”€β”€ server.ts           # μ„λ²„ μ‹μ‘ λ΅μ§
β”‚   β”β”€β”€ middlewares/        # μ»¤μ¤ν…€ λ―Έλ“¤μ›¨μ–΄λ“¤
β”‚   β”‚   β”β”€β”€ logger.ts       # μ”μ²­ λ΅κΉ… λ―Έλ“¤μ›¨μ–΄
β”‚   β”‚   β”β”€β”€ auth.ts         # μΈμ¦ ν† ν° κ²€μ¦ λ―Έλ“¤μ›¨μ–΄
β”‚   β”‚   β”β”€β”€ validation.ts   # λ°μ΄ν„° μ ν¨μ„± κ²€μ‚¬ λ―Έλ“¤μ›¨μ–΄
β”‚   β”‚   β””β”€β”€ rateLimit.ts    # μ”μ²­ μ ν• λ―Έλ“¤μ›¨μ–΄
β”‚   β”β”€β”€ integration-test/
β”‚   β”‚   β””β”€β”€ app.test.ts     # Supertest ν†µν•©ν…μ¤νΈ
β”‚   β””β”€β”€ setupTests.ts       # Jest ν…μ¤νΈ μ„¤μ •
β”β”€β”€ prisma/
β”‚   β””β”€β”€ schema.prisma       # Prisma μ¤ν‚¤λ§
β”β”€β”€ .env                    # ν™κ²½λ³€μ (DATABASE_URL)
β””β”€β”€ jest.config.js          # Jest μ„¤μ •
```

## π› οΈ μ„¤μΉ λ° μ‹¤ν–‰

### 1. μμ΅΄μ„± μ„¤μΉ

```bash
npm install
```

### 2. ν™κ²½λ³€μ μ„¤μ •

`.env` νμΌμ— λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²° μ •λ³΄λ¥Ό μ„¤μ •ν•μ„Έμ”:

```
DATABASE_URL="postgresql://postgres:password@localhost:5432/testdb"
DB_HOST=localhost
```

### 3. Prisma μ„¤μ •

```bash
# Prisma ν΄λΌμ΄μ–ΈνΈ μƒμ„±
npx prisma generate

# λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ… (μ„ νƒμ‚¬ν•­)
npx prisma migrate dev
```

### 4. κ°λ° μ„λ²„ μ‹¤ν–‰

```bash
npm run dev
```

### 5. ν…μ¤νΈ μ‹¤ν–‰

```bash
npm test
```

## π§ ν…μ¤νΈ

### ν…μ¤νΈ μ‹¤ν–‰

```bash
# λ¨λ“  ν…μ¤νΈ μ‹¤ν–‰
npm test

# ν…μ¤νΈ κ°μ‹ λ¨λ“
npm run test:watch
```

### ν…μ¤νΈ λ‚΄μ©

- **κΈ°λ³Έ λΌμ°νΈ ν…μ¤νΈ**: GET `/` μ—”λ“ν¬μΈνΈ
- **λ³΄μ• ν—¤λ” ν…μ¤νΈ**: Helmet λ―Έλ“¤μ›¨μ–΄ κ²€μ¦
- **λ―Έλ“¤μ›¨μ–΄ μ²΄μΈ ν…μ¤νΈ**: μ—¬λ¬ λ―Έλ“¤μ›¨μ–΄κ°€ μμ„λ€λ΅ μ‹¤ν–‰λλ”μ§€ κ²€μ¦
- **μΈμ¦ ν…μ¤νΈ**: ν† ν° κ²€μ¦ λ―Έλ“¤μ›¨μ–΄ λ™μ‘ ν™•μΈ
- **μ ν¨μ„± κ²€μ‚¬ ν…μ¤νΈ**: λ°μ΄ν„° κ²€μ¦ λ―Έλ“¤μ›¨μ–΄ λ™μ‘ ν™•μΈ
- **μ”μ²­ μ ν• ν…μ¤νΈ**: Rate Limiting λ―Έλ“¤μ›¨μ–΄ λ™μ‘ ν™•μΈ
- **μ—λ¬ μ²λ¦¬ ν…μ¤νΈ**: κ° λ―Έλ“¤μ›¨μ–΄μ—μ„ λ°μƒν•λ” λ‹¤μ–‘ν• μ—λ¬ μƒν™©

## π”§ λ―Έλ“¤μ›¨μ–΄

### μ „μ—­ λ―Έλ“¤μ›¨μ–΄

1. **Helmet** (λ³΄μ•)

   - XSS κ³µκ²© λ°©μ§€
   - Content Security Policy μ„¤μ •
   - Clickjacking λ°©μ§€
   - κΈ°νƒ€ λ³΄μ• ν—¤λ” μλ™ μ„¤μ •

2. **Morgan** (λ΅κΉ…)

   - HTTP μ”μ²­ λ΅κΉ…
   - μ”μ²­ μ‹κ°„, λ©”μ„λ“, URL, μƒνƒ μ½”λ“ κΈ°λ΅
   - κ°λ° λ° λ””λ²„κΉ…μ— μ μ©

3. **express.json** (JSON νμ‹±)
   - JSON μ”μ²­ λ³Έλ¬Έ νμ‹±
   - API μ”μ²­ μ²λ¦¬μ— ν•„μ

### λΌμ°νΈλ³„ λ―Έλ“¤μ›¨μ–΄ μ²΄μΈ

κ° λΌμ°νΈμ—λ” μ—¬λ¬ λ―Έλ“¤μ›¨μ–΄κ°€ μμ„λ€λ΅ μ μ©λ©λ‹λ‹¤:

## π“ API μ—”λ“ν¬μΈνΈ

### GET `/`

κΈ°λ³Έ λΌμ°νΈ - μ„λ²„ μƒνƒ ν™•μΈ

```json
{
  "message": "Express μ„λ²„κ°€ λ™μ‘μ¤‘μ…λ‹λ‹¤!",
  "dbHost": "localhost"
}
```

### GET `/users`

μ‚¬μ©μ λ©λ΅ μ΅°ν

```json
[
  {
    "id": 1,
    "email": "user@example.com",
    "name": "μ‚¬μ©μ",
    "createdAt": "2024-01-01T00:00:00.000Z",
    "updatedAt": "2024-01-01T00:00:00.000Z"
  }
]
```

### POST `/users`

μƒ μ‚¬μ©μ μƒμ„±

```json
{
  "email": "newuser@example.com",
  "name": "μƒ μ‚¬μ©μ"
}
```

## π³ Docker PostgreSQL μ„¤μ •

PostgreSQLμ„ Dockerλ΅ μ‹¤ν–‰ν•λ” κ²½μ°:

```bash
docker run --name postgres-test \
  -e POSTGRES_PASSWORD=password \
  -e POSTGRES_DB=testdb \
  -p 5432:5432 \
  -d postgres:latest
```

## π“ μ¤ν¬λ¦½νΈ

- `npm run dev`: κ°λ° μ„λ²„ μ‹¤ν–‰ (ts-node-dev)
- `npm run build`: TypeScript μ»΄νμΌ
- `npm start`: ν”„λ΅λ•μ… μ„λ²„ μ‹¤ν–‰
- `npm test`: ν…μ¤νΈ μ‹¤ν–‰
- `npm run test:watch`: ν…μ¤νΈ κ°μ‹ λ¨λ“

## π” ν…μ¤νΈ κ²°κ³Ό μμ‹

```
Test Suites: 2 passed, 2 total
Tests:       15 passed, 15 total
Snapshots:   0 total
Time:        2.743 s
```

λ¨λ“  ν…μ¤νΈκ°€ μ„±κ³µμ μΌλ΅ ν†µκ³Όν•λ©°, λ―Έλ“¤μ›¨μ–΄ μ²΄μΈμ΄ μμ„λ€λ΅ μ‹¤ν–‰λλ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

### λ―Έλ“¤μ›¨μ–΄ μ‹¤ν–‰ μμ„ ν™•μΈ

μ½μ†” λ΅κ·Έλ¥Ό ν†µν•΄ λ―Έλ“¤μ›¨μ–΄κ°€ μμ„λ€λ΅ μ‹¤ν–‰λλ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤:

```
[2025-08-03T09:01:44.673Z] GET /users - μ”μ²­ μ‹μ‘
β±οΈ μ”μ²­ μ ν• ν™•μΈ μ¤‘: ::ffff:127.0.0.1
β… μƒλ΅μ΄ μ”μ²­ μλ„μ° μ‹μ‘
π” μΈμ¦ ν† ν° κ²€μ¦ μ¤‘: ν† ν° μμ
β… ν† ν° κ²€μ¦ μ„±κ³µ
π― μ‚¬μ©μ λ©λ΅ μ΅°ν ν•Έλ“¤λ¬ μ‹¤ν–‰
[2025-08-03T09:01:44.687Z] GET /users - μ‘λ‹µ μ™„λ£ (200)
```
